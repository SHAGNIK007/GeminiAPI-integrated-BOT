<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gemini Terminal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="terminal">
    <div id="output"></div>

    <div class="input-line">
        <span class="prompt">shagnik@dev:~$</span>
        <input type="text" id="user-input" autofocus autocomplete="off">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<script>
const input = document.getElementById("user-input");
const output = document.getElementById("output");

input.addEventListener("keydown", async function(e) {
    if (e.key === "Enter") {
        const message = input.value.trim();
        if (!message) return;

        printUser(message);
        input.value = "";

        const thinking = showThinking();

        const response = await fetch("/chat", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ message })
        });

        const data = await response.json();

        thinking.remove();
        printBot(data.reply);

        output.scrollTop = output.scrollHeight;
    }
});

function printUser(text) {
    const line = document.createElement("div");
    line.innerHTML = `<span class="prompt">shagnik@dev:~$</span> ${text}`;
    output.appendChild(line);
}

function printBot(text) {
    const line = document.createElement("div");
    line.classList.add("bot");
    line.innerHTML = marked.parse(text);
    output.appendChild(line);
}

function showThinking() {
    const line = document.createElement("div");
    line.classList.add("thinking");
    line.innerHTML = `bot: thinking...`;
    output.appendChild(line);
    return line;
}
</script>

</body>
</html>
